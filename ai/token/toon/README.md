# TOON (Token-Oriented Object Notation)

LLM時代のための新しいデータフォーマット

## 概要

**TOON**（Token-Oriented Object Notation）は、LLM入力での使用を想定して設計されたデータフォーマットです。JSONのデータモデルをベースに、**トークン最小化**と**構造の明確性**を両立させることを目的としています。

### 設計思想

```
+------------------+     変換      +------------------+
|   JSON           |  -------->   |   TOON           |
| (プログラム用)    |              | (LLM入力用)       |
+------------------+              +------------------+
```

既存のJSONをプログラム間では使用しつつ、LLM入力時にTOON形式へ変換するという使い分けが想定されています。

## 特徴・利点

| 特徴 | 説明 |
|------|------|
| **トークン効率** | JSONと比較して約40%のトークン削減を実現 |
| **構造精度** | 明示的な配列長 `[N]` とフィールドヘッダ `{fields}` によりLLMが解析しやすい |
| **学習容易性** | In-context Learningで即座に習得可能（既知パターンの組み合わせ） |
| **汎用性** | DSL的な効率とJSON的な汎用性を両立 |
| **信頼性向上** | 構造メタデータによりハルシネーション低減 |

## 構文仕様

### 基本構文

| 記法 | 説明 | 例 |
|------|------|-----|
| `key: value` | 単純なキー・バリュー | `task: Our favorite hikes` |
| `key[N]` | N個の要素を持つシンプル配列 | `friends[3]: ana,luis,sam` |
| `key[N]{col1,col2}:` | N行のテーブル形式（オブジェクト配列） | 下記参照 |
| `key:` + インデント | ネストされたオブジェクト（YAML風） | 下記参照 |
| `\t` | デリミタをタブに変更（TSV対応） | - |

### 具体例

**TOON形式**:
```toon
store:
  name: 東京書店
categories[3]: 小説,漫画,技術書
books[3]{id,title,price}:
  1,吾輩は猫である,680
  2,ドラえもん,499
  3,リーダブルコード,2640
```

**同等のJSON**:
```json
{
  "store": {
    "name": "東京書店"
  },
  "categories": ["小説", "漫画", "技術書"],
  "books": [
    {"id": 1, "title": "吾輩は猫である", "price": 680},
    {"id": 2, "title": "ドラえもん", "price": 499},
    {"id": 3, "title": "リーダブルコード", "price": 2640}
  ]
}
```

### ファイル仕様

- **拡張子**: `.toon`
- **メディアタイプ**: `text/toon`

## 他フォーマットとの比較

### トークン効率ランキング

| 順位 | フォーマット | 1,000トークンあたりの精度 |
|------|-------------|-------------------------|
| 1 | **TOON** | 26.9% |
| 2 | JSON compact | 22.9% |
| 3 | YAML | 18.6% |
| 4 | JSON | 15.3% |

### ベンチマーク結果

| 指標 | TOON | JSON |
|------|------|------|
| 精度 | 73.9% | 69.7% |
| トークン削減率 | - | (基準) |
| 相対削減 | **約39.6%削減** | - |

### フォーマット推奨度（著者見解）

1. **TOON** - 最高効率（専用DSL）
2. **JSON+Schema** - Web標準で精度高い
3. **JSONL/CSV** - シンプルだが柔軟性に欠ける
4. **YAML/XML** - LLM処理で効率悪い
5. **自然言語** - 再現性が低い

## 使用場面

### 適している場面

| 場面 | 具体例 | 効果 |
|------|--------|------|
| **均一なオブジェクト配列** | 商品一覧、従業員リスト、検索結果 | 約40%トークン削減、73.9%精度 |
| **表形式データ** | 時系列データ、イベントログ | 構造明確化でハルシネーション防止 |
| **WebアプリとLLM間のデータ授受** | APIレスポンス、DBクエリ結果 | スキーマ明示による信頼性向上 |
| **データ検索・抽出タスク** | 欄抽出、フィルタリング | 99.6%精度（欄抽出） |

### 適さない場面

| 場面 | 理由 | 代替手段 |
|------|------|----------|
| **散文的なドキュメント・仕様書** | テキスト重視データには不向き | Markdown、自然言語 |
| **深くネストした複雑構造** | JSONの方がトークン効率が良い | JSON compact |
| **不規則なスキーマ** | フィールドが行ごとに異なる | JSON |
| **レイテンシ最優先** | 変換オーバーヘッドが問題 | JSON直接利用 |
| **純粋な表形式** | CSVの方が若干効率的（5-10%差） | CSV |

### 仕様書作成には使える？

**基本的には不向き**です。TOONは「構造化データの伝送」に特化しており、散文的な仕様書やドキュメント作成には適していません。

ただし、**仕様書内のデータテーブル部分**（APIエンドポイント一覧、パラメータ定義表など）をLLMに読み込ませる際には有効です。

> "自然文をそのまま文字列として格納するだけでは、JSONに対する優位性は生まれません"
> — 参考記事より

### タスク別の精度

| タスク | 精度 |
|--------|------|
| 欄抽出 | 99.6% |
| 構造認識 | 88.0% |
| 構造検証 | 70.0% |
| フィルタリング | 56.3% |
| 集約タスク | 54.4% |

## まとめ

TOONは「JSONの構造保証」と「CSVの軽さ」を融合したフォーマットです。特に均一なオブジェクト配列をLLMに入力する際に、トークン効率と構造精度の両面で優れた効果を発揮します。

## 参考リンク

- [TOON GitHub リポジトリ](https://github.com/toon-format/toon)
- [TOON フォーマット解説記事](https://cleath.space/input/20251210a.html)
