# CLAUDE.md の書き方ガイド

## 概要

CLAUDE.md は Claude Code の**プロジェクトメモリ**の1つで、各セッション開始時に自動的に読み込まれる。Claude Code には合計6種類のメモリ機構があり、それぞれスコープと用途が異なる。

| メモリ種類 | 配置場所 | スコープ |
|-----------|---------|---------|
| 管理者ポリシー | システムレベル `CLAUDE.md` | 組織全体 |
| プロジェクトメモリ | `./CLAUDE.md` or `./.claude/CLAUDE.md` | チーム共有（Git管理） |
| プロジェクトルール | `./.claude/rules/*.md` | チーム共有（Git管理） |
| ユーザーメモリ | `~/.claude/CLAUDE.md` | 自分のみ（全プロジェクト） |
| ローカルメモリ | `./CLAUDE.local.md` | 自分のみ（プロジェクト固有） |
| Auto Memory | `~/.claude/projects/<project>/memory/` | 自分のみ（自動学習） |

このガイドは、チーム共有のプロジェクトメモリとしての **CLAUDE.md の書き方**に焦点を当てる。メモリシステム全体の詳細については [メモリシステム詳細ガイド](./claude/claude-code-settings/02-memory.md) を参照。

---

## 目次

- [概要](#概要)
- [3つの重要な構成要素](#3つの重要な構成要素)
- [書くべき内容 / 書くべきでない内容](#書くべき内容--書くべきでない内容)
- [クリティカルな制約](#クリティカルな制約)
- [ベストプラクティス](#ベストプラクティス)
  - [段階的開示（Progressive Disclosure）](#段階的開示progressive-disclosure)
  - [重要ルールの強調構文](#重要ルールの強調構文)
  - [メモリ機構の活用](#メモリ機構の活用)
  - [Compactionのカスタマイズ](#compaction圧縮のカスタマイズ)
  - [Skills との使い分け](#skillsclaudeskillsとの使い分け)
  - [スタイルガイドの扱い](#スタイルガイドの扱い)
  - [自動生成の回避](#自動生成の回避)
- [アンチパターン](#アンチパターン)
- [トラブルシューティング](#トラブルシューティング)
- [テンプレート例](#テンプレート例)
- [まとめ](#まとめ)
- [参考](#参考)

---

## 3つの重要な構成要素

効果的な CLAUDE.md には以下の3つを含める：

### 1. WHAT（技術スタック）

プロジェクトの技術的な概要を提供する。

```markdown
## 技術スタック
- フレームワーク: Next.js 14 (App Router)
- 言語: TypeScript
- データベース: PostgreSQL + Prisma
- スタイリング: Tailwind CSS

## プロジェクト構造
src/
├── app/          # ルーティング・ページ
├── components/   # 再利用可能なUIコンポーネント
├── lib/          # ユーティリティ・共通関数
└── services/     # 外部サービス連携
```

### 2. WHY（目的）

プロジェクトの意図と各部分の機能を明確化する。

```markdown
## プロジェクト概要
このプロジェクトは〇〇のための△△システムである。
主な目的:
- ユーザーが□□できるようにする
- △△の効率化を図る
```

### 3. HOW（実行方法）

テスト実行、型チェック、ビルドなど、実際の作業に必要なコマンドを記載する。

```markdown
## 開発コマンド
- 開発サーバー起動: `npm run dev`
- テスト実行: `npm test`
- 型チェック: `npm run type-check`
- リント: `npm run lint`
- ビルド: `npm run build`
```

---

## 書くべき内容 / 書くべきでない内容

公式ベストプラクティスでは、各行について「これを削除したら Claude がミスをするか？」と自問し、Noなら削除すべきとされている。

### 書くべき内容

- Claude が推測できないBashコマンド（ビルド、テスト、リント）
- デフォルトと**異なる**コードスタイルルール
- テスト手順・優先テストランナー
- リポジトリの作法（ブランチ命名、PRルール）
- プロジェクト固有のアーキテクチャ判断
- 開発環境の注意点（必要な環境変数など）
- 非自明な挙動・ハマりどころ

### 書くべきでない内容

- コードを読めばわかること
- 言語の標準的な慣習（Claude は既に知っている）
- 詳細なAPIドキュメント（リンクで代替）
- 頻繁に変わる情報
- 長い説明やチュートリアル
- ファイルごとの説明
- 自明な指示（「きれいなコードを書け」など）
- シークレット・APIキー（セキュリティリスク）
- リンターが対応するスタイルルール

---

## クリティカルな制約

### 指示数の制限

| 観点 | 推奨値 |
|------|--------|
| フロンティアLLMが従える指示数 | **150〜200個** |
| Claude Code 自体の指示数 | 約50個 |
| ユーザーが追加できる実質的な指示数 | **100〜150個程度** |

> 小規模モデルでは、指示数増加に伴い性能がより急速に低下する。

### ファイル長の目安

- 推奨: **300行未満**
- 理想: **60行以下**（HumanLayerの実例）

長くなりすぎると、重要な指示が埋もれてしまうリスクがある。

---

## ベストプラクティス

### 段階的開示（Progressive Disclosure）

タスク固有の情報は別ファイルに分離し、CLAUDE.md ではそれらへのポインタを提供する。

```markdown
## 詳細ドキュメント
- API設計: `docs/api-design.md` を参照
- データベーススキーマ: `docs/database.md` を参照
- デプロイ手順: `docs/deployment.md` を参照
```

### 重要ルールの強調構文

特に守らせたいルールには `IMPORTANT` や `YOU MUST` などの強い表現を使うと遵守率が向上する。

```markdown
# 重要な規約
IMPORTANT: テストを書かずにPRを出さないこと
YOU MUST: すべてのAPIレスポンスで統一エラーフォーマットを使うこと
```

ただし、すべてのルールを強調すると効果が薄れるため、**本当にクリティカルなルール（3-5個）にのみ**使用する。

### メモリ機構の活用

CLAUDE.md に書くべき内容を減らし、適切なメモリ機構に分散することで、ファイルを簡潔に保てる。

#### `@import` 構文

既存ドキュメントを CLAUDE.md から参照することで、情報の重複を避けられる。

```markdown
プロジェクト概要は @README.md を参照してください。
API設計ガイドラインは @docs/api-guidelines.md に従ってください。
```

| ルール | 詳細 |
|--------|------|
| パス解決 | インポート元ファイルからの相対パス（作業ディレクトリではない） |
| 絶対パス | 使用可能（例: `@~/.claude/my-instructions.md`） |
| 再帰上限 | 最大5階層まで再帰的に解決 |
| コードブロック内 | マークダウンのコードブロック・コードスパン内では無効 |
| 初回承認 | プロジェクトごとに初回のみ承認ダイアログが表示される |

> **なぜ `@import` を使うのか？** README.md や既存の設計書に書いてある内容を CLAUDE.md にコピーすると、更新のたびに二重管理が発生する。`@import` を使えば「単一の情報源」を維持しながら Claude にも伝えられる。

#### `.claude/rules/` ディレクトリ

トピック別にルールファイルを分割し、CLAUDE.md の肥大化を防ぐ。

```
.claude/rules/
├── code-style.md    # コーディングスタイル
├── testing.md       # テスト規約
└── security.md      # セキュリティ要件
```

YAML フロントマターで `paths` を指定すると、特定ファイルパスにのみルールを適用できる：

```markdown
---
paths:
  - "src/api/**/*.ts"
---
# API開発ルール
- すべてのエンドポイントで入力バリデーションを行うこと
- レスポンスは統一フォーマットで返すこと
```

> **なぜ `rules/` を使うのか？** CLAUDE.md が長大になると管理が難しくなる。トピックごとにファイルを分けることで、特定のルールを見つけやすくなり、レビュー時の差分も小さくなる。

#### `CLAUDE.local.md`（個人設定）

個人の好みやローカル環境情報を記載するファイル。自動的に `.gitignore` に追加されるため、チームに影響を与えない。

```markdown
# CLAUDE.local.md

## 個人の好み
- 回答は日本語で
- コミットメッセージは英語で

## ローカル環境情報
- Node.js v22 を使用
- データベースは localhost:5432 で起動済み
```

> **なぜ `CLAUDE.local.md` を使うのか？** 個人設定を `CLAUDE.md`（チーム共有）に書くとメンバー間で衝突する。個人設定は `CLAUDE.local.md` に分離することで、チームの CLAUDE.md をクリーンに保てる。

#### Auto Memory（自動学習）

Claude が作業中に有用な情報（ビルドコマンド、デバッグの知見、ユーザーの好みなど）を自動的に保存する仕組み。`~/.claude/projects/<project>/memory/MEMORY.md` の先頭200行が毎セッション読み込まれる。

詳細は [メモリシステム詳細ガイド](./claude/claude-code-settings/02-memory.md) を参照。

### Compaction（圧縮）のカスタマイズ

Claude Code はコンテキストが長くなると自動的に会話を圧縮する。CLAUDE.md に圧縮時の指示を書くことで、重要な情報が失われることを防げる。

```markdown
## Compaction指示
When compacting, always preserve the full list of modified files and any test commands.
```

また、手動で `/compact <指示>` を実行することも可能。無関係なタスク間では `/clear` でコンテキストをリセットするのも有効。

### Skills（`.claude/skills/`）との使い分け

CLAUDE.md は**毎セッション読み込まれる**ため、普遍的に適用される情報のみを含めるべきである。特定の場面でのみ必要なドメイン知識やワークフローは **Skills** に分離する。

```
.claude/skills/
├── SKILL.md           # スキル定義
├── deploy-guide.md    # デプロイ時のみ必要
└── migration.md       # DB移行時のみ必要
```

> **なぜ Skills を使うのか？** CLAUDE.md にすべてを詰め込むと指示が増え、遵守率が下がる。Skills はオンデマンドで読み込まれるため、普段の会話を汚さずに専門知識を提供できる。

### スタイルガイドの扱い

**「LLMをリンターの役割に使うな」**

コード整形はツール化すべきであり、CLAUDE.md に細かいスタイルルールを書かない。

代わりに活用すべきもの：
- **Hooks**: 自動的にフォーマットを適用
- **Slash Commands**: 特定のタスクを実行
- **既存のリンター/フォーマッター**: ESLint, Prettier など

### 自動生成の回避

CLAUDE.md は高レバレッジポイントであるため、自動生成より**丁寧な手作業**を推奨する。

ただし、`/init` コマンドで CLAUDE.md の**初期スケルトンを生成**することは有効である。`/init` はプロジェクトの package.json、既存ドキュメント、設定ファイル、コード構造を分析して出発点を作成する。生成後に手作業で精査・編集することが重要。

---

## アンチパターン

| 避けるべきこと | 理由 |
|---------------|------|
| 指示の過剰な記載 | モデルの性能低下を招く |
| 細かいスタイルルールの列挙 | ツールで解決すべき（リンター/フォーマッター活用） |
| 自動生成への依存 | 品質が担保されない |
| 1ファイルにすべてを詰め込む | `@import` や `rules/` に分散すべき |
| 曖昧な説明 | 誤解を招く |

---

## トラブルシューティング

| 症状 | 原因と対処 |
|------|-----------|
| Claude がルールを無視する | ファイルが長すぎて指示が埋もれている。削減する |
| CLAUDE.md に書いた内容を Claude が質問してくる | 記述が曖昧。より明確に書き直す |
| 時間とともに効果が薄れる | 定期的に棚卸しする。「CLAUDE.md をコードのように扱い、問題が起きたらレビューし、定期的に prune せよ」（公式） |

> CLAUDE.md はGitで管理し、チームで改善を重ねることで価値が**複利的に増加**する。

---

## テンプレート例

```markdown
# CLAUDE.md

## プロジェクト概要
[1-2文でプロジェクトの目的を説明]

## 技術スタック
- [言語/フレームワーク]
- [データベース]
- [その他主要技術]

## プロジェクト構造
[主要ディレクトリの説明]

## 開発コマンド
- 開発: `[コマンド]`
- テスト: `[コマンド]`
- ビルド: `[コマンド]`

## 重要な規約
- [最も重要なルール1]
- [最も重要なルール2]
- [最も重要なルール3]

## 詳細ドキュメント
- [ドキュメントへのポインタ]
- 詳細ルール: @docs/coding-standards.md

## 個人設定
詳細は CLAUDE.local.md に記載（gitignore 対象）
```

---

## まとめ

1. **簡潔に保つ**: 300行未満、理想は60行以下
2. **WHAT/WHY/HOW を明確に**: 技術スタック、目的、実行方法を含める
3. **書くべき/書くべきでないを意識する**: 各行が「削除したらClaudeがミスするか」のテストに合格するもののみ残す
4. **メモリ機構を使い分ける**: `@import`・`rules/`・`CLAUDE.local.md`・Auto Memory・Skills を活用して CLAUDE.md を軽量化
5. **重要ルールは強調する**: `IMPORTANT` / `YOU MUST` を厳選して使う
6. **ツールを活用**: スタイリングはリンター/フォーマッターに任せる
7. **手作業で丁寧に**: `/init` で出発点を作り、手作業で磨き上げる
8. **定期的に棚卸しする**: CLAUDE.md をコードのように管理し、prune する

---

## 参考

- [Writing a Good CLAUDE.md - HumanLayer](https://www.humanlayer.dev/blog/writing-a-good-claude-md)
- [Memory - Claude Code 公式ドキュメント](https://code.claude.com/docs/en/memory)
- [Best Practices - Claude Code 公式ドキュメント](https://code.claude.com/docs/en/best-practices)
- [Using CLAUDE.MD files | Anthropic公式ブログ](https://claude.com/blog/using-claude-md-files)
- [Skills - Claude Code 公式ドキュメント](https://code.claude.com/docs/en/skills)
- [How Anthropic teams use Claude Code | Anthropic公式ブログ](https://claude.com/blog/how-anthropic-teams-use-claude-code)
- [メモリシステム詳細ガイド（本リポジトリ）](./claude/claude-code-settings/02-memory.md)
