# CLAUDE.md の書き方ガイド

## 概要

CLAUDE.md は Claude Code エージェントとの**すべての対話に自動的に含まれる唯一のファイル**である。各セッション開始時、モデルはコードベースについて何も知らない状態であるため、このファイルが最初の文脈となる。

---

## 3つの重要な構成要素

効果的な CLAUDE.md には以下の3つを含める：

### 1. WHAT（技術スタック）

プロジェクトの技術的な概要を提供する。

```markdown
## 技術スタック
- フレームワーク: Next.js 14 (App Router)
- 言語: TypeScript
- データベース: PostgreSQL + Prisma
- スタイリング: Tailwind CSS

## プロジェクト構造
src/
├── app/          # ルーティング・ページ
├── components/   # 再利用可能なUIコンポーネント
├── lib/          # ユーティリティ・共通関数
└── services/     # 外部サービス連携
```

### 2. WHY（目的）

プロジェクトの意図と各部分の機能を明確化する。

```markdown
## プロジェクト概要
このプロジェクトは〇〇のための△△システムである。
主な目的:
- ユーザーが□□できるようにする
- △△の効率化を図る
```

### 3. HOW（実行方法）

テスト実行、型チェック、ビルドなど、実際の作業に必要なコマンドを記載する。

```markdown
## 開発コマンド
- 開発サーバー起動: `npm run dev`
- テスト実行: `npm test`
- 型チェック: `npm run type-check`
- リント: `npm run lint`
- ビルド: `npm run build`
```

---

## クリティカルな制約

### 指示数の制限

| 観点 | 推奨値 |
|------|--------|
| フロンティアLLMが従える指示数 | **150〜200個** |
| Claude Code 自体の指示数 | 約50個 |
| ユーザーが追加できる実質的な指示数 | **100〜150個程度** |

> 小規模モデルでは、指示数増加に伴い性能がより急速に低下する。

### ファイル長の目安

- 推奨: **300行未満**
- 理想: **60行以下**（HumanLayerの実例）

長くなりすぎると、重要な指示が埋もれてしまうリスクがある。

---

## ベストプラクティス

### 段階的開示（Progressive Disclosure）

タスク固有の情報は別ファイルに分離し、CLAUDE.md ではそれらへのポインタを提供する。

```markdown
## 詳細ドキュメント
- API設計: `docs/api-design.md` を参照
- データベーススキーマ: `docs/database.md` を参照
- デプロイ手順: `docs/deployment.md` を参照
```

### スタイルガイドの扱い

**「LLMをリンターの役割に使うな」**

コード整形はツール化すべきであり、CLAUDE.md に細かいスタイルルールを書かない。

代わりに活用すべきもの：
- **Hooks**: 自動的にフォーマットを適用
- **Slash Commands**: 特定のタスクを実行
- **既存のリンター/フォーマッター**: ESLint, Prettier など

### 自動生成の回避

CLAUDE.md は高レバレッジポイントであるため、自動生成より**丁寧な手作業**を推奨する。

---

## アンチパターン

| 避けるべきこと | 理由 |
|---------------|------|
| 指示の過剰な記載 | モデルの性能低下を招く |
| 細かいスタイルルールの列挙 | ツールで解決すべき |
| 自動生成への依存 | 品質が担保されない |
| 1ファイルにすべてを詰め込む | 見通しが悪くなる |
| 曖昧な説明 | 誤解を招く |

---

## テンプレート例

```markdown
# CLAUDE.md

## プロジェクト概要
[1-2文でプロジェクトの目的を説明]

## 技術スタック
- [言語/フレームワーク]
- [データベース]
- [その他主要技術]

## プロジェクト構造
[主要ディレクトリの説明]

## 開発コマンド
- 開発: `[コマンド]`
- テスト: `[コマンド]`
- ビルド: `[コマンド]`

## 重要な規約
- [最も重要なルール1]
- [最も重要なルール2]
- [最も重要なルール3]

## 詳細ドキュメント
- [ドキュメントへのポインタ]
```

---

## まとめ

1. **簡潔に保つ**: 300行未満、理想は60行以下
2. **WHAT/WHY/HOW を明確に**: 技術スタック、目的、実行方法を含める
3. **段階的開示**: 詳細は別ファイルに分離
4. **ツールを活用**: スタイリングはリンター/フォーマッターに任せる
5. **手作業で丁寧に**: 自動生成に頼らない

---

## 参考

- [Writing a Good CLAUDE.md - HumanLayer](https://www.humanlayer.dev/blog/writing-a-good-claude-md)
