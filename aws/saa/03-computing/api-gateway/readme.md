# Amazon API Gateway
AWSサービスと連携するAPIの作成や管理ができる機能。  
マネージドサービスなので、Lambdaと組み合わせることで完全にサーバーレスでWebアプリケーションを実行できる。

例：  
1. クライアントからのHTTPリクエストをAPI Gatewayで受信
2. それをトリガーとしてLambda関数を実行
3. レスポンスをAPI Gateway経由で返す

## REST API（RESTful API）
クライアントからのリクエストに対してレスポンスを返す形式のAPI。  
サーバーが扱う情報はURI(URL)で定義されており、クライアントはHTTP（HTTPS）でリクエストを送信することでレスポンスを得る。  

データベースの検索など、クライアントからのリクエストに応答するアプリケーションで使用される。  

※ REST API（RESTful API）とは？  
REST（REpresentational State Transfer）という原則にのっとったAPIのことです。通信の状態が管理されない「ステートレス」な接続方式。

## WebSocket API
クライアントとサーバー間でリアルタイムな情報のやり取りを目的とするAPI。  
REST APIとは違い、継続的なデータの送受信を行える。

チャットや株価情報のような常に情報をモニタリングするようなアプリケーションで使われる。

※ WebSocket APIとは？  
サーバー・クライアント間で双方向のセッションを確立できる技術を利用したAPIのこと。通信の状態を管理される「ステートフル」な接続方式。

## API キャッシュ
Amazon API Gatewayにはクライアントへ送信したデータを保存する「API キャッシュ」機能がある。

REST APIではどのクライアントからでも同一のリクエストであれば同一のレスポンスになる。API キャッシュではクライアントに送ったレスポンスをAPI Gatewayでキャッシュし、再度同一のリクエストを受け取るとキャッシュからデータを返す。  
API キャッシュから応答を返すことにより、Lambda関数の実行を省略できるのでレスポンス速度が向上します。

## VPCリンク
前提：  
Amazon API Gatewayで作成したAPIは、ユーザーが管理するVPC外に配置される。  
そのため、作成したAPIからインターネットを経由してパブリックサブネット内のAWSリソースにはアクセスできるが、プライベートサブネット内のAWSリソースへ直接アクセスすることはできない。

API Gatewayからプライベートサブネット内のAWSリソースへアクセスさせたい場合は「VPCリンク」を作成する。  
これにより、APIとプライベートサブネット内のリソースとの間でインターネットを経由しないセキュアな通信が可能になる。
VPCリンク作成時に、アクセスしたいAWSリソース（EC2インスタンスなど）を直接指定することはできません。Network Load Balancerを対象として指定する。

## Canaryリリース
API Gatewayでは、「ステージ」という概念を使用して、APIの異なるバージョンや開発段階を管理します。これにより、開発、テスト、本番などの異なる環境でAPIを個別に管理できます。

Canaryリリースは、新しいバージョンのAPIを段階的にリリースする方法です。  
1. まず、既存の本番ステージに新しいAPIバージョンをデプロイし、一部のトラフィックを新しいバージョンに向けます。例えば、初めは20%のトラフィックを新バージョンに割り当てます。
2. 新バージョンが安定して動作することが確認されたら、トラフィックの割合を徐々に増やしていく
3. 最終的には全トラフィックを新バージョンに移行します。もし問題が発生した場合は、すぐに元のバージョンに戻すことができます。Canaryリリースを利用することで、リスクを分散し、ユーザーへの影響を最小限に抑えることができます。
