# Amazon ElastiCache
フルマネージド型のインメモリデータベースサービス。
インメモリデータベースとはデータストレージにメモリを使用するデータベースのこと。  

SSDのようなディスクストレージよりも高速・安定したアクセスが可能で、主にパフォーマンスを重視するアプリケーションに利用されている。RDSやRedshiftなど他のデータベースサービスと連携し、クエリの結果をElastiCacheにキャッシュさせることで全体的なパフォーマンスを向上させる、というような使い方ができる。


## Memcached
* データの永続保持やバックアップ機能がない
* 障害や再起動などが発生した場合はデータは残らない
* マルチAZに対応していない

保持しておかなければならないデータはストレージや他のデータベースサービスへ保存しておき、アプリケーションの高速化を目的にキャッシュとして利用する、といったケースに向いている。

## Redis
Memcachedよりも高機能なデータベースエンジン。
* スナップショット（Amazon S3への保存）機能によるバックアップ・リストアが可能
  * データを永続的に保持しておくことができる
* 耐障害性の機能として「自動フェイルオーバー」「マルチAZ」がある
* 保管しているデータの暗号化やSSL/TLSによる通信の暗号化
* クライアントをパスワードで認証するRedis認証
  * これらを利用するには、ElastiCacheのデータベース作成時に「Redis」を選択し、暗号化を有効にする必要がある

## 自動フェイルオーバー機能
プライマリノードに障害が発生した場合は、自動的にレプリカノードがプライマリノードへ昇格する。  
またマルチAZではAZを跨いだレプリケーションが可能なため、プライマリノードが存在するAZに障害が発生した場合でも、別のAZのレプリカノードを昇格させることにより運用を継続することができる。

※ElastiCacheにおいて各ノードは「キャッシュノード」と呼ばれる。  
* プライマリノード
  * 更新・参照などを行えるノード
* レプリカノード
  * 参照のみを行えるノード（リードレプリカ）

## キャッシュ戦略
高速アクセスを実現するElastiCacheは、アプリケーションのパフォーマンス向上に主に使用されます。データをどのように保存するかというキャッシュ戦略は、データの整合性や可用性を保ちながら、パフォーマンスを最大化するために重要です。
以下に、代表的なキャッシュ戦略の2つを紹介します。

### ライト（書き込み）スルー戦略
* データベースへのデータ書き込みや更新が行われるたびに、同時にキャッシュにも書き込みます。
* この戦略では、キャッシュのデータが常に最新の状態を保たれるため、データの整合性が維持されます。
* しかし、書き込み性能が若干低下する可能性があるのと、アクセスされないデータがキャッシュに蓄積されるというデメリットもあります。

### 遅延読み込み戦略
* データベースへの書き込みを優先し、必要な時にのみキャッシュにデータを書き込みます。
* アプリケーションがデータを要求した際には、まずキャッシュを確認します。
* キャッシュにデータが存在する場合、そのデータをアプリケーションに返します。
* データが存在しない場合には、データベースからデータを取得し、そのデータをアプリケーションに提供した後でキャッシュに書き込みます。
* この方法では要求されたデータのみがキャッシュされるため、リソースの無駄遣いを減らすことができますが、キャッシュとデータベース間で一時的なデータの不一致が生じる可能性があります。
* また、キャッシュミス（キャッシュからデータを取得できなかった）した場合には、データ取得に時間がかかることがあります。
