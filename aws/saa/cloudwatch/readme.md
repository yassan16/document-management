# Amazon CloudWatch
AWSサービスやオンプレミス（自社運用）のシステムを監視し、しきい値（境界値）を超える・下回るなどした場合に管理者に通報するなど、サービスのリソース（CPU使用率やストレージの使用状況など）の状態に応じたアクションを取らせる機能のこと。

## 特徴
* メトリクスの収集・監視
* アラームとアクション
* ログの収集・分析（CloudWatch Logs）


## メリット
* サービスの安定した運用やパフォーマンスの向上、サービスの改善


## メトリクスの収集・監視
CloudWatchが監視する様々なリソースの情報は「メトリクス」と呼ばれる。  

### 標準メトリクス
予め定義されているメトリクスを標準メトリクスと呼ぶ。  
 → インスタンスのCPU使用率やディスクの読み取り・書き込みの量など

### 例
* EC2
  * CPU使用率
  * ディスクの読み取り
  * 書き込み量
* S3
  * バケットサイズ
  * ファイル（オブジェクト）数
* ELB
  * リクエスト数
  * リクエストの応答時間
* RDS
  * ストレージの空き容量
  * 秒間の読み取り
  * 書き込み操作の量


### カスタムメトリクス
標準メトリクスでカバーされない項目、例えばメモリ使用量やディスクの空き容量などは、管理者が「カスタムメトリクス」として定義し、CloudWatchエージェントをインストールしたEC2インスタンスからAWS CLIコマンドやAPIを用いてCloudWatchへ送信することで監視できる。

### 例
* メモリ使用量
* ディスクの空き容量・使用状況
* プロセス情報

## アラームとアクション
設定したメトリクスに基づいてアラームを設定し、条件を満たした際に特定のアクションを自動的に実行することができる。  
インスタンスの再起動・停止・終了・復旧というアクションも可能。

### 例
* EC2インスタンスのCPU使用率が80%を超えた場合、管理者宛にメール通知するというアクションを設定する

## ログの収集・分析（CloudWatch Logs）
AWSサービスやEC2インスタンスのOSやアプリケーションのログを収集し、一元管理するサービス。  
収集したログは、メッセージの内容をフィルタリングして管理者に通知させることができる。
　→ EC2インスタンス上のアプリケーションやOSのログを収集するには、対象のEC2インスタンスへ「CloudWatchエージェント」をインストールする必要がある

### 例
* CloudTrailにおけるAWSサービスの操作ログ
* VPCフローログなどを収集
* EC2インスタンスのOSログで"Error"の文字列を1時間に5回検出した場合、管理者へメール通知する

### その他サービスへの連携
フィルタリングしたログをAmazon Data FirehoseやAWS Lambda、Amazon OpenSearch Serviceなどの別のサービスへ転送し、ログをリアルタイムに解析したり、ログの内容に応じてプログラムを実行させる、といった連携が可能。  
別のサービスへ転送するには、CloudWatch Logsのサブスクリプションフィルターで、データの転送先を設定する必要あり。
