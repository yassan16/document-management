# Amazon S3（Simple Storage Service）
安価で耐久性が高く、保存容量が無制限のオブジェクトストレージサービス。

## 特徴
* SaaS
  * ユーザーはアプリケーションの構築や障害対応などを考慮する必要なし
* アップロードされたデータはリージョン内の3か所以上のAZに保存される
  * 非常に高い耐久性がある
* オブジェクトストレージ
* VPC外にあるため、セキュリティグループを使用できない

## オブジェクトストレージ
ディレクトリのような階層構造を持たず、データに固有IDを付与した「オブジェクト」として扱うストレージのこと。  

* オブジェクトキー
  * オブジェクトに割り当てられる固有ID
  * 各データはオブジェクトキーによって一意に特定できる

## バケット
オブジェクトが保尊される領域のこと。  

## オブジェクトロック
S3バケットに保存したオブジェクトに対して更新・削除を制限する機能。  
オブジェクトロックを有効にするとバージョニング機能も有効になる。

### リーガルホールド
権限（s3:PutObjectLegalHold）を持たないユーザーに対して、リーガルホールドが解除されるまでオブジェクトを読み取り専用にする。  
権限を持つユーザーのみオブジェクトの更新・削除と、リーガルホールドの解除ができる。

### リテンションモード
#### ガバナンスモード
権限（s3:BypassGovernanceRetention）を持たないユーザーに対して、指定した保持期間中オブジェクトを読み取り専用にする。  
権限を持つユーザーのみオブジェクトの更新・削除と、ガバナンスモードの解除ができる。

#### コンプライアンスモード
ルートユーザーを含む全てのユーザーに対して、指定した保持期間中オブジェクトを読み取り専用にする。  
保持期間中はルートユーザーを含めてコンプライアンスモードを解除できません。


## S3バッチオペレーション
S3のオブジェクトに対して大規模なバッチ処理を実行するための機能。  

## S3 Object Lambda
S3オブジェクトをリアルタイムでカスタマイズする機能。  

1. S3 Object Lambdaでは、S3 Object Lambdaアクセスポイントを、Lambda関数とS3バケットに作成したS3アクセスポイントに紐づける
2. S3 Object Lambdaアクセスポイントを経由したS3オブジェクトへのリクエストをトリガーとして、Lambda関数を実行し、処理後のデータを返すことができる

リアルタイムでフィルタリング、圧縮、再フォーマット、データ加工などの処理が可能で、オブジェクトを動的に修正や変換できる。  
元のデータに変更を加えることなく、S3オブジェクトへのアクセス時に自動的にデータ処理を適用できるため、柔軟性と効率性が向上する。

## S3イベント通知
S3バケットに発生したイベント（データの作成や削除など）をトリガーに通知を行う機能。  
以下の通知先に対応している。
* Lambda関数
* SNSトピック
* SQSキュー
* EventBridge

対応外
* EC2
* SageMaker Pipelines

また、同一条件の通知を複数の宛先に送ることはできない。

## S3レプリケーション
S3バケットのデータを異なるバケットへ自動的にコピーしたい場合に使用します。  
S3レプリケーションを設定すると、指定した他のバケットへ自動的にオブジェクトをコピーします。レプリケーション先は、同一AWSアカウントが所有するバケットでも、異なるAWSアカウントが所有するバケットでも指定できます。  
S3レプリケーションには、コピー先を同一リージョンのバケットにする「同一リージョンレプリケーション」と、異なるリージョンのバケットにする「クロスリージョンレプリケーション」があります。

## 署名付きURL
非公開設定されたオブジェクトに対して有効期限のついたURLを発行することで、AWSアカウントを持っていないユーザーでも一時的にアクセスが可能になる機能です。署名付きURLはオブジェクトのダウンロードの他、アップロード用のURLも発行可能です。  
署名付きURLには非常に長いランダムな文字列が入るため、URLを知らない人が推測することはほぼ不可能です。署名付きURLを利用することで、S3のデータを特定のユーザーに期限付きでアクセスさせることができます。しかしユーザー認証機能はないため、URLが漏洩すると誰でもアクセスができてしまいます。

## マルチパートアップロード
S3バケットに保存できるオブジェクトの最大サイズは5TBですが、一度にアップロードできる最大サイズは5GBです。5GBを超えるファイルをアップロードするには「マルチパートアップロード」を利用します。  

マルチパートアップロードは、単一のオブジェクトをパートといわれる複数のデータに分割して、S3バケットにアップロードする機能です。各パートはそれぞれ並列にアップロードされるので、アップロード時間を大幅に短縮できます。また、パートの一部に送信エラーが発生しても、他のパートへ影響を及ぼすことなくエラーが発生したパートのみを再送します。AWSではファイルサイズが100MB以上の場合は、マルチパートアップロードの使用を推奨しています。

マルチパートアップロードのプロセスが完了せずに中断されると「不完全なマルチパートアップロード」となります。この状況は、ネットワークの問題、アプリケーションのエラー、またはユーザーによる中断などによって発生する可能性があります。  
この状態では各パートのアップロードが完了していないため、ファイルは正常に使用できません。また、不完全なパートはストレージスペースを占有し、それに対する料金が発生するため、不必要なコストを発生させる可能性があります。
対策として、ライフサイクルポリシーの機能を使い、不完全なマルチパートアップロードを削除するポリシーを設定し自動的に削除することで、不要なストレージ使用量とコストを削減できます。
