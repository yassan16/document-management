# ドメイン駆動設計 Domain-Driven Design （DDD）
業務領域（ドメイン）を中心に据えた設計手法。  
以降は、「DDD」と呼称する。

## DDDの目的
* 機能性を高める
  * 役立つものを作る
  * 「作ったけど使えない」を避ける
* 保守性を高める
  * 長期間開発しても、機能拡張が容易
  * 「技術的負債でどんどん開発速度が低下する」を避ける

## 目的を達成するためのアプローチ
* 機能性を高める
  * ドメインモデリング
* 保守性を高める
  * モデルをそのまま表現する実装
  * エンティティ、リポジトリなどの実装パターン
* DDDの特徴
  * 「ドメインモデル」を使って両方のアプローチがリンクすること
  * 片方ずつでも効果が出るが、両方使うと大きな相乗効果が出る

## ドメインモデリングってどうやるのか？
特に１つこの手法があると決まってるわけではない。  
数ある中でおすすめなのが、「sudoモデリング」である。  

## sudoモデリング
sudoモデリングでは、4つのモデル図を作成する。
* システム関連図(s)
* ユースケース図(u)
* ドメインモデル図(d)
* オブジェクト図(o)

### システム関連図
開発するシステムと関わりのあるactorや外部システムとの関連を示す図。  
この図を作成することで、「誰が使用するシステムなのか？」を明確にする。

#### 題材
人事などの採用担当者が企業への応募者を管理する、採用管理システムとする。  
以下のsudoモデリングでの説明でも、この内容を使用する。

##### actor
* 応募者
  * 採用ページからリンクを飛んで、フォームで応募する
* 採用担当者

##### システム
* 応募フォーム
  * 応募者が使用する
  * 採用管理システムへ応募フォームからの自動連携は、最初は行わない  
    直接、採用管理システムに手入力
* 採用管理システム（今回開発するシステム）
  * 採用担当者が操作する
  * 応募者が直接、このシステムに登録しない
  * メール送信リクエストを、メール送信システムに送る
* メール送信システム
  * メール送信は外部のマネージドサービスを使用する

### ユースケース図
ユーザの要求に対してシステムの振る舞いを定義する図。
この後にドメインモデル図を作成するため、どのようなユースケースを抑えるべきを観点として作る。  
以降のドメインでのスコープを明確にする。

#### 例
採用担当者が、以下のことを実行できる。
##### 採用管理システム
* 採用選考を登録する
* 面接を設定する
##### 外部連携
* 候補者にメールを送信する

### ドメインモデル図・オブジェクト図
ドメインモデル図とは、簡易化したクラス図のようなもの。  
次のようなルールで記載する。
* オブジェクトの代表的な属性を書くが、メソッドは書かなくてよい
* 「ルール/制約(ドメイン知識)」を吹き出しに書き出す
* オブジェクト同士の関連を示す
* 集約の範囲を定義する
* 日本語と英語の対訳を定義する  

最終的に、まとめた内容がクラスになる。

#### 書き方
1. まず具体例を元に、オブジェクト図を作る  
2. 抽象化して、ドメインモデル図を作る

#### ドメイン知識
* 最終的にエンティティ/値オブジェクトとなるオブジェクト、それに関わるルール/制約(ドメイン知識)を記載する
* 検討メモ：図を作成する際に生じた疑問は、その場で議論して決定した内容を記載する  
  未決定事項や今後の展開も同様にメモする

#### 多重度
* 「採用選考から採用ボジションを紐づけることは必須なのか？」といったことは、ルール/制約として大事な意思決定となる

#### 集約の範囲
* オブジェクト、ルール/制約がある程度できたら、集約の範囲を決定する
* リポジトリは集約に対して１つ作るので、集約の範囲が決まるとエンティティ、値オブジェクト、リポジトリがどういう形で実装されるか決まる
* ただし集約の良し悪しは、実装してみないとわからないことが多い  
  実装して問題があれば、ドメインモデル図に戻って更新する

#### 日本語名の対訳としての英語名
* ここで英語名を決めることで、以降のエンドポイント名、テーブル名、クラス名などで使用される英語の表記揺れを防げる




