# AWS Storage Gateway
オンプレミスからAWSのストレージサービスへのアクセスを、高速かつセキュアに行うことができるサービス。

Storage Gatewayそのものは、Amazon S3やAmazon FSxなどのようなストレージサービスではない。
Gateway*1の名が示す通り、オンプレミスとAWSストレージサービスとを橋渡しする役目を持つサービス。  
 → ユーザーはStorage Gatewayを利用することによって、オンプレミスからS3やFSxなどのストレージサービスをデータ保存先として利用できる

*1 Gateway  
規格の異なるネットワーク間を中継して接続する機器。

AWSへデータを移行した後もオンプレミスから継続してデータが更新されるケースで利用します。

## ユースケース
* 堅牢性・耐久性に優れたS3をファイル共有ストレージとして利用
* 災害対策を目的としたバックアップやアーカイブを行う
* あまりアクセスされないデータを自社サーバーからAWSへ移動させる

## ファイルゲートウェイ
オンプレミスからNFS（Network File System）またはSMB（Server Message Block）を使用してAWSストレージへアクセスできるサービスです。

NFSとSMBは、どちらもサーバーなどへ保存されたファイルを複数のクライアントで共有するためのネットワークプロトコル（通信手順）です。
* NFS
  * Linuxを含むUNIX系OSに使用
* SMB
  * Windows系OSに使用
ファイルゲートウェイには、使用するAWSストレージによって2つの種類があります。

### 〇S3ファイルゲートウェイ
オンプレミスからNFSまたはSMBを使用して、S3バケットへアクセスできるようにするゲートウェイタイプです。ローカル（オンプレミス）にキャッシュストレージを持つため低レイテンシでのアクセスも可能です。

S3ファイルゲートウェイは、オンプレミスのファイルベースのアプリケーションを使用してS3バケットへアクセスできます。オンプレミスのアプリケーションからS3へアクセスを使用するには、ファイルゲートウェイをVM（仮想マシン）としてオンプレミスにデプロイします。  
また、ファイルゲートウェイではIAMを利用して各部署ごとにアクセス可能なS3バケットを設定できる。


### 〇FSxファイルゲートウェイ
オンプレミスからSMBを使用して、FSx for Windows File Serverへアクセスできるようにするゲートウェイタイプです。S3ファイルゲートウェイと同じく、ローカルにキャッシュストレージを持つため低レイテンシでのアクセスも可能です。

※ FSxは、NFSプロトコルをネイティブにサポートしていない。

## ボリュームゲートウェイ
オンプレミスからiSCSI*1を使用して、S3をブロックストレージボリュームとして利用できるサービスです。サーバーはiSCSIで接続されたストレージ（Storage Gatewayの場合はS3）をローカルディスクとして利用できる。  
ボリュームストレージ上のデータはS3にEBSスナップショットとして保存可能なので、災害対策や定期的なバックアップに利用できる。  
ボリュームゲートウェイには2つの種類がある。

*1 iSCSIとは？  
Internet Small Computer System Interface  
コンピュータのストレージを接続するSCSIをTCP/IPで実現したプロトコルのこと。

### 〇キャッシュ型（キャッシュボリューム）
すべてのデータをS3に保存し、高頻度アクセスのデータのみオンプレミスのキャッシュストレージにコピーする。
* メインの運用データはS3に保存される
* データがキャッシュ上に存在しない場合はS3へアクセスするので遅延が発生する
* 反面、オンプレミスのストレージ容量を抑えることができる

### 〇保管型（ストアドボリューム）
すべてのデータをオンプレミスのボリュームストレージに保存し、S3に非同期でバックアップを保存する。
* メインの運用データは引き続きオンプレミスで利用される
* バックアップとしてのスナップショットがAWSのS3に保存される
* S3へのアクセスによる遅延が発生しない

